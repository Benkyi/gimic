#!/bin/sh

PREFIX="$HOME/gimic"
CFOUR=""

stallo() {
	if [ -f /etc/profile.d/modules.sh ]; then
		. /etc/profile.d/modules.sh
		module load python
	fi
	BLASDIR="/opt/intel/mkl/10.0.011"
	PYTHON="--with-python=/global/apps/python/2.5.1"
	for i in $*; do
		case $i in
			--para*|mpi) PARAFLAGS="--enable-mpi=openmpi" ;;
			--prefix=*) PREFIX=$i ;;
			--cfour=*) CFOUR="--with-aces2=${i#cfour=}" ;;
		esac
	done
	CC=icc FC=ifort ./configure $PREFIX $PARAFLAGS $CFOUR
}

snowflake() {
BLASDIR=/opt/lib
INSTDIR=/opt/aces2
case $* in
	--mpi) 
	FC=gfortran ./configure --prefix=${INSTDIR}.par --enable-mpi=openmpi
	;;
	*)
	./configure --prefix=${INSTDIR} --with-blas-dir=$BLASDIR \
	--with-fc-search-path=/opt/flibs \
	--with-aces2=$HOME/software/mainz/aces2/lib
	;;
esac
}

macosx() {
	PREFIX="--prefix=/opt/gimic"
	for i in $*; do
		case $i in
			--para*|mpi) PARAFLAGS="--enable-mpi=openmpi" ;;
			--prefix=*) PREFIX=$i ;;
			--cfour=*) CFOUR="--with-aces2=${i#cfour=}" ;;
		esac
	done	
	FC=gfortran ./configure $PREFIX $PARAFLAGS $CFOUR	
}

case `hostname` in
	stallo*) stallo $*; exit 0 ;;
esac

case `uname` in
	Linux*)
	if [ -f /etc/lsb-release ]; then
		. /etc/lsb-release
	else
		echo "/etc/lsb-release not found. Unknown host type, run configure by hand."
	fi

	case $DISTRIB_ID in
		*buntu*) 
		   [ $DISTRIB_RELEASE = "8.10" ] && intrepid $* 
		   [ $DISTRIB_RELEASE = "9.04" ] && intrepid $* 
		;;
		*) echo "Unknown distribution: $DISTRIB_DESCRIPTION"; exit 1 ;;
	esac
	;;
	Darwin)
		macosx $*
	;;
esac
